<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Care Plan æ•°æ®åº“è®¾è®¡ - ER å›¾</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .diagram-container {
            background: #fafafa;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
            overflow-x: auto;
        }
        .info-section {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .table-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .table-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .table-card h3 {
            color: #2980b9;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .table-card ul {
            list-style: none;
            padding: 0;
        }
        .table-card li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .table-card li:last-child {
            border-bottom: none;
        }
        .pk { color: #e74c3c; font-weight: bold; }
        .fk { color: #9b59b6; font-weight: bold; }
        .uk { color: #f39c12; font-weight: bold; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .connection-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ Care Plan Generator - æ•°æ®åº“è®¾è®¡æ–‡æ¡£</h1>

        <div class="info-section">
            <h3>ğŸ“‹ é¡¹ç›®æ¦‚è¿°</h3>
            <p>æœ¬ç³»ç»Ÿä½¿ç”¨ <strong>PostgreSQL 15</strong> æ•°æ®åº“ï¼Œé€šè¿‡ Django ORM ç®¡ç†ï¼ŒåŒ…å« 4 ä¸ªæ ¸å¿ƒæ•°æ®è¡¨ï¼Œç”¨äºç®¡ç†æ‚£è€…ã€åŒ»ç”Ÿã€è®¢å•å’ŒæŠ¤ç†è®¡åˆ’çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚</p>
        </div>

        <h2>ğŸ“Š å®ä½“å…³ç³»å›¾ (ER Diagram)</h2>
        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    PATIENT ||--o{ ORDER : "has"
    PROVIDER ||--o{ ORDER : "prescribes"
    ORDER ||--|| CARE_PLAN : "generates"

    PATIENT {
        uuid id PK
        varchar mrn UK "ç—…å†å·(6ä½)"
        varchar first_name "å"
        varchar last_name "å§“"
        date dob "å‡ºç”Ÿæ—¥æœŸ"
        timestamp created_at
        timestamp updated_at
    }

    PROVIDER {
        uuid id PK
        varchar npi UK "åŒ»ç”Ÿæ‰§ç…§å·(10ä½)"
        varchar name "å§“å"
        timestamp created_at
    }

    ORDER {
        uuid id PK
        uuid patient_id FK
        uuid provider_id FK
        varchar medication_name "è¯ç‰©åç§°"
        varchar primary_diagnosis "ä¸»è¦è¯Šæ–­ICD-10"
        json additional_diagnoses "é™„åŠ è¯Šæ–­"
        json medication_history "ç”¨è¯å†å²"
        text patient_records "æ‚£è€…è®°å½•"
        varchar status "çŠ¶æ€"
        text error_message "é”™è¯¯ä¿¡æ¯"
        timestamp created_at
        timestamp updated_at
        timestamp completed_at
    }

    CARE_PLAN {
        uuid id PK
        uuid order_id FK "ä¸€å¯¹ä¸€"
        text content "æŠ¤ç†è®¡åˆ’å†…å®¹"
        timestamp generated_at "ç”Ÿæˆæ—¶é—´"
        varchar llm_model "LLMæ¨¡å‹"
        varchar llm_prompt_version "Promptç‰ˆæœ¬"
    }
            </div>
        </div>

        <div class="connection-info">
            <h3>ğŸ”Œ æ•°æ®åº“è¿æ¥ä¿¡æ¯</h3>
            <p><strong>è¿æ¥å­—ç¬¦ä¸²:</strong> <code>postgresql://careplan:careplan123@db:5432/careplan</code></p>
            <ul>
                <li><strong>ä¸»æœº:</strong> db (Docker å†…éƒ¨) / localhost (æœ¬åœ°è®¿é—®)</li>
                <li><strong>ç«¯å£:</strong> 5432</li>
                <li><strong>æ•°æ®åº“å:</strong> careplan</li>
                <li><strong>ç”¨æˆ·å:</strong> careplan</li>
                <li><strong>å¯†ç :</strong> careplan123</li>
            </ul>
            <p><em>é…ç½®æ–‡ä»¶ä½ç½®: <code>docker-compose.yml</code> å’Œ <code>backend/config/settings.py</code></em></p>
        </div>

        <h2>ğŸ“‘ æ•°æ®è¡¨è¯¦ç»†è¯´æ˜</h2>

        <div class="table-info">
            <div class="table-card">
                <h3>ğŸ‘¤ patients (æ‚£è€…è¡¨)</h3>
                <ul>
                    <li><span class="pk">id</span> - UUID ä¸»é”®</li>
                    <li><span class="uk">mrn</span> - ç—…å†å· (6ä½ï¼Œå”¯ä¸€)</li>
                    <li>first_name - å</li>
                    <li>last_name - å§“</li>
                    <li>dob - å‡ºç”Ÿæ—¥æœŸ</li>
                    <li>created_at - åˆ›å»ºæ—¶é—´</li>
                    <li>updated_at - æ›´æ–°æ—¶é—´</li>
                </ul>
            </div>

            <div class="table-card">
                <h3>ğŸ‘¨â€âš•ï¸ providers (åŒ»ç”Ÿè¡¨)</h3>
                <ul>
                    <li><span class="pk">id</span> - UUID ä¸»é”®</li>
                    <li><span class="uk">npi</span> - æ‰§ç…§å· (10ä½ï¼Œå”¯ä¸€)</li>
                    <li>name - åŒ»ç”Ÿå§“å</li>
                    <li>created_at - åˆ›å»ºæ—¶é—´</li>
                </ul>
            </div>

            <div class="table-card">
                <h3>ğŸ“‹ orders (è®¢å•è¡¨)</h3>
                <ul>
                    <li><span class="pk">id</span> - UUID ä¸»é”®</li>
                    <li><span class="fk">patient_id</span> - æ‚£è€…å¤–é”®</li>
                    <li><span class="fk">provider_id</span> - åŒ»ç”Ÿå¤–é”®</li>
                    <li>medication_name - è¯ç‰©åç§°</li>
                    <li>primary_diagnosis - ICD-10 ä¸»è¯Šæ–­</li>
                    <li>additional_diagnoses - é™„åŠ è¯Šæ–­ (JSON)</li>
                    <li>medication_history - ç”¨è¯å†å² (JSON)</li>
                    <li>patient_records - æ‚£è€…è®°å½•</li>
                    <li>status - pending/processing/completed/failed</li>
                    <li>error_message - é”™è¯¯ä¿¡æ¯</li>
                    <li>created_at - åˆ›å»ºæ—¶é—´</li>
                    <li>updated_at - æ›´æ–°æ—¶é—´</li>
                    <li>completed_at - å®Œæˆæ—¶é—´</li>
                </ul>
            </div>

            <div class="table-card">
                <h3>ğŸ“„ care_plans (æŠ¤ç†è®¡åˆ’è¡¨)</h3>
                <ul>
                    <li><span class="pk">id</span> - UUID ä¸»é”®</li>
                    <li><span class="fk">order_id</span> - è®¢å•å¤–é”® (ä¸€å¯¹ä¸€)</li>
                    <li>content - æŠ¤ç†è®¡åˆ’å†…å®¹ (æ–‡æœ¬)</li>
                    <li>generated_at - ç”Ÿæˆæ—¶é—´</li>
                    <li>llm_model - ä½¿ç”¨çš„ LLM æ¨¡å‹</li>
                    <li>llm_prompt_version - Prompt ç‰ˆæœ¬å·</li>
                </ul>
            </div>
        </div>

        <h2>ğŸ”— å…³ç³»è¯´æ˜</h2>
        <div class="info-section">
            <ul>
                <li><strong>Patient â†’ Order:</strong> ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªè®¢å•</li>
                <li><strong>Provider â†’ Order:</strong> ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªåŒ»ç”Ÿå¯ä»¥å¼€å…·å¤šä¸ªè®¢å•</li>
                <li><strong>Order â†’ CarePlan:</strong> ä¸€å¯¹ä¸€å…³ç³»ï¼Œæ¯ä¸ªè®¢å•ç”Ÿæˆä¸€ä¸ªæŠ¤ç†è®¡åˆ’</li>
            </ul>
        </div>

        <h2>ğŸ”„ çŠ¶æ€æµè½¬</h2>
        <div class="diagram-container">
            <div class="mermaid">
graph LR
    A[pending<br/>å¾…å¤„ç†] --> B[processing<br/>å¤„ç†ä¸­]
    B --> C[completed<br/>å·²å®Œæˆ]
    B --> D[failed<br/>å¤±è´¥]
    style A fill:#fff3cd
    style B fill:#cfe2ff
    style C fill:#d1e7dd
    style D fill:#f8d7da
            </div>
        </div>

        <h2>ğŸ“‚ ç›¸å…³æ–‡ä»¶</h2>
        <div class="info-section">
            <ul>
                <li><code>docker-compose.yml</code> - æ•°æ®åº“æœåŠ¡é…ç½®</li>
                <li><code>backend/careplan/models.py</code> - Django æ¨¡å‹å®šä¹‰</li>
                <li><code>backend/config/settings.py</code> - æ•°æ®åº“è¿æ¥é…ç½®</li>
                <li><code>.env</code> - ç¯å¢ƒå˜é‡é…ç½®</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#3498db',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#2980b9',
                lineColor: '#7f8c8d',
                secondaryColor: '#ecf0f1',
                tertiaryColor: '#fff'
            }
        });
    </script>
</body>
</html>
